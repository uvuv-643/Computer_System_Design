#include "write_driver.h"

#include <stdio.h>
#include <stdlib.h>


void write_color(const enum LightState color) {

	if(PinState != GPIO_PIN_RESET)
	  {
	    GPIOx->BSRR = GPIO_Pin;
	  }
	  else
	  {
	    GPIOx->BSRR = (uint32_t)GPIO_Pin << 16U;
	  }

     HAL_GPIO_WritePin(GPIOD, GPIO_PIN_13, GPIO_PIN_RESET);
     HAL_GPIO_WritePin(GPIOD, GPIO_PIN_14, GPIO_PIN_RESET);
     HAL_GPIO_WritePin(GPIOD, GPIO_PIN_15, GPIO_PIN_RESET);

    switch (color) {
        case RED:
        case RED_SHORT:
        	GPIOD->BSRR = GPIO_PIN_15;
//        	HAL_GPIO_WritePin(GPIOD, GPIO_PIN_15, GPIO_PIN_SET);
            break;
        case GREEN:
        case GREEN_SHORT:
        	GPIOD->BSRR = GPIO_PIN_13;
//        	HAL_GPIO_WritePin(GPIOD, GPIO_PIN_13, GPIO_PIN_SET);
            break;
        case YELLOW:
        case YELLOW_SHORT:
        	GPIOD->BSRR = GPIO_PIN_14;
//        	HAL_GPIO_WritePin(GPIOD, GPIO_PIN_14, GPIO_PIN_SET);
            break;
        case GREEN_FLUSHING:
        case GREEN_FLUSHING_SHORT:
            if ((HAL_GetTick() / 300) % 2 == 0) {
            	GPIOD->BSRR = GPIO_PIN_13;
//                 HAL_GPIO_WritePin(GPIOD, GPIO_PIN_13, GPIO_PIN_SET);
            } else {
            	GPIOD->BSRR = (uint32_t)GPIO_PIN_13 << 16U;
//                 HAL_GPIO_WritePin(GPIOD, GPIO_PIN_13, GPIO_PIN_RESET);
            }
            break;
    }
}
